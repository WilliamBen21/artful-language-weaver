<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisualStory - Where Stories Come Alive</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --dark-bg: #0A0B0E;  /* Deeper, richer black */
            --card-bg: rgba(16, 17, 22, 0.85);  /* Slightly blue-tinted dark */
            --glass-bg: rgba(255, 255, 255, 0.08);  /* More subtle glass effect */
            
            /* Modern gradients */
            --primary-gradient: linear-gradient(135deg, #6366F1 0%, #4F46E5 100%);  /* Electric indigo */
            --secondary-gradient: linear-gradient(135deg, #EC4899 0%, #F43F5E 100%);  /* Modern pink to red */
            --accent-gradient: linear-gradient(135deg, #10B981 0%, #059669 100%);  /* Fresh mint */
            
            /* Text colors */
            --text-primary: #F9FAFB;  /* Crisp white */
            --text-secondary: #9CA3AF;  /* Subtle gray */
            --border-color: rgba(255, 255, 255, 0.08);  /* More subtle borders */

            /* Additional modern accents */
            --success-color: #10B981;  /* Mint green */
            --error-color: #EF4444;    /* Bright red */
            --warning-color: #F59E0B;  /* Warm amber */
            --info-color: #3B82F6;     /* Electric blue */
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(99, 102, 241, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 100% 0%, rgba(236, 72, 153, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 50% 100%, rgba(16, 185, 129, 0.03) 0%, transparent 50%);
        }

        /* DYNAMIC HEADER */
        .dynamic-header {
            position: fixed;
            top: 0;
            left: 320px;
            right: 0;
            height: 80px;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            z-index: 200;
            display: flex;
            align-items: center;
            padding: 0 32px;
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }

        .dynamic-header.visible {
            transform: translateY(0);
        }

        .header-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--secondary-gradient);
            margin-right: 16px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }

        .header-info {
            flex: 1;
        }

        .header-username {
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .header-story-title {
            color: var(--text-secondary);
            font-size: 14px;
            opacity: 0.8;
        }

        .header-actions {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .header-action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
        }

        .header-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .app-container {
            display: flex;
            min-height: 100vh;
            position: relative;
        }

        .sidebar {
            width: 320px;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-color);
            padding: 24px;
            position: fixed;
            height: 100vh;
            z-index: 100;
            transition: transform 0.3s ease;
        }

        .logo-section {
            display: flex;
            align-items: center;
            margin-bottom: 40px;
            padding: 12px;
        }

        .logo {
            width: 48px;
            height: 48px;
            background: var(--primary-gradient);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            margin-right: 16px;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-section {
            margin-bottom: 32px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 8px;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--glass-bg);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .nav-item:hover::before {
            opacity: 1;
        }

        .nav-item.active {
            background: var(--primary-gradient);
            transform: translateX(4px);
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        }

        .nav-icon {
            font-size: 20px;
            margin-right: 16px;
            width: 24px;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .nav-text {
            font-weight: 500;
            font-size: 15px;
            position: relative;
            z-index: 1;
        }

        .trending-section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
        }

        .trending-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        .trending-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .trending-item:last-child {
            border-bottom: none;
        }

        .trending-number {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--accent-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            margin-right: 12px;
        }

        .trending-text {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .main-content {
            margin-left: 320px;
            flex: 1;
            min-height: 100vh;
            transition: margin-top 0.3s ease;
        }

        .main-content.header-visible {
            margin-top: 80px;
        }

        /* INFINITE SCROLL FOUNDATION */
        .main-feed {
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: none;
            scrollbar-width: none;
            scroll-behavior: smooth;
            position: relative;
        }

        .main-feed::-webkit-scrollbar {
            display: none;
        }

        /* Story Card Foundation */
        .story-card {
            min-height: 100vh;
            display: flex;
            scroll-snap-align: start;
            position: relative;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            margin-bottom: 2px; /* Small gap between cards for infinite scroll */
        }

        /* Loading States for Infinite Scroll */
        .loading-spinner {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid var(--primary-gradient);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: none;
        }

        .loading-spinner.visible {
            display: block;
        }

        @keyframes spin {
            0% { transform: translateX(-50%) rotate(0deg); }
            100% { transform: translateX(-50%) rotate(360deg); }
        }

        .end-of-feed {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-size: 14px;
            display: none;
        }

        .end-of-feed.visible {
            display: block;
        }

        /* Intersection Observer Trigger */
        .scroll-trigger {
            height: 10px;
            position: absolute;
            bottom: 100vh;
            width: 100%;
            pointer-events: none;
        }

        .video-section {
            width: 60%;
            position: relative;
            background: #111;
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            transform-origin: center center;
            will-change: transform;
            opacity: 0.95;
        }

        .video-section.shrunk {
            transform: scale(0.98) translateX(-2%); /* Even gentler transform */
            border-radius: 16px;
            opacity: 0.85;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .video-container {
            width: 100%;
            height: 100vh;
            position: relative;
            overflow: hidden;
            border-radius: 0 24px 24px 0;
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            will-change: transform;
            backface-visibility: hidden;
            transform: translateZ(0);
        }

        .video-section.shrunk .video-container {
            border-radius: 24px;
        }

        .ai-video {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--dark-bg) 0%, rgba(16, 17, 22, 0.95) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ai-video:hover {
            background: linear-gradient(135deg, rgba(16, 17, 22, 0.95) 0%, var(--dark-bg) 100%);
        }

        .ai-video::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 40%, rgba(99, 102, 241, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 70% 60%, rgba(236, 72, 153, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }

        .video-overlay {
            position: absolute;
            top: 24px;
            right: 24px;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .ai-badge {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .ai-badge:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-1px);
        }

        .video-section.shrunk .video-overlay {
            opacity: 0.8;
            transform: scale(0.9);
        }

        @media (max-width: 768px) {
            .video-overlay {
                top: 16px;
                right: 16px;
            }
        }

        .video-prompt {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.4;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            padding: 12px 16px;
            border-radius: 12px;
        }

        .story-section {
            width: 40%;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            padding: 24px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--border-color);
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            opacity: 0.9;
        }

        .video-section.shrunk + .story-section {
            width: 42%; /* Minimal width change */
            transform: translateX(-1%); /* Minimal movement */
            opacity: 1;
        }

        .story-header {
            display: flex;
            align-items: center;
            margin-bottom: 24px;
        }

        .author-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--secondary-gradient);
            margin-right: 16px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        .author-info h4 {
            color: var(--text-primary);
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .author-info span {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .story-content {
            flex: 1;
            margin-bottom: 24px;
        }

        .genre-tag {
            background: var(--accent-gradient);
            padding: 6px 12px;
            border-radius: 50px;
            font-size: 11px;
            font-weight: 600;
            margin-bottom: 16px;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .story-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
            line-height: 1.3;
        }

        .story-text {
            font-size: 15px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 16px;
        }

        .story-chain {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 16px;
            margin: 16px 0;
            position: relative;
        }

        .story-chain::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--accent-gradient);
            border-radius: 0 2px 2px 0;
        }

        .chain-author {
            font-size: 12px;
            color: #4ecdc4;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .story-actions {
            display: flex;
            gap: 20px;
            padding: 20px 0;
            border-top: 1px solid var(--border-color);
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 8px 12px;
            border-radius: 12px;
        }

        .action-btn:hover {
            color: var(--text-primary);
            background: var(--glass-bg);
            transform: translateY(-1px);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.15);
        }

        .action-btn.liked {
            color: #ff6b6b;
        }

        .continue-story-btn {
            width: 100%;
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 16px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            margin-top: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
        }

        .continue-story-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.4);
        }

        /* CREATE PAGE STYLES - VIDEO FIRST */
        .create-story-section {
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
            height: 100vh;
            overflow-y: auto;
        }

        .create-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .create-header h1 {
            font-size: 32px;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
        }

        .create-header p {
            color: var(--text-secondary);
            font-size: 16px;
        }

        /* VIDEO PROMPT SECTION - FIRST THING VISIBLE */
        .video-prompt-section {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 32px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 24px;
        }

        .prompt-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .prompt-header h2 {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .prompt-header p {
            color: var(--text-secondary);
            font-size: 15px;
        }

        .input-group {
            margin-bottom: 24px;
        }

        .input-group label {
            display: block;
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .video-description-input {
            width: 100%;
            min-height: 120px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            color: var(--text-primary);
            font-size: 15px;
            line-height: 1.6;
            resize: vertical;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .video-description-input:focus {
            outline: none;
            border-color: #6366F1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .style-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }

        .style-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .style-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .style-card.active {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .style-preview {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .style-name {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 13px;
        }

        .create-video-btn {
            width: 100%;
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 18px 24px;
            border-radius: 16px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-top: 24px;
        }

        .create-video-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.4);
        }

        /* VIDEO PREVIEW SECTION - HIDDEN INITIALLY */
        .video-preview-section {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 32px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            margin-bottom: 24px;
        }

        .preview-header {
            text-align: center;
            margin-bottom: 24px;
        }

        .preview-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .preview-header p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .video-player {
            width: 100%;
            max-width: 500px;
            height: 300px;
            margin: 0 auto 16px;
            border-radius: 16px;
            overflow: hidden;
            border: 2px solid var(--border-color);
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .video-player:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .video-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .video-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 40%, rgba(102, 126, 234, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 70% 60%, rgba(79, 172, 254, 0.2) 0%, transparent 50%);
        }

        .play-button {
            font-size: 48px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            position: relative;
            z-index: 10;
        }

        .play-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .video-info {
            text-align: center;
            color: white;
            font-size: 14px;
            font-weight: 500;
            position: relative;
            z-index: 10;
        }

        .video-actions {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .video-action-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .video-action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: #667eea;
            transform: translateY(-1px);
        }

        .proceed-to-story {
            text-align: center;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 16px;
            padding: 24px;
        }

        .proceed-to-story p {
            color: var(--text-primary);
            font-size: 16px;
            margin-bottom: 16px;
            font-weight: 500;
        }

        .primary-action-btn {
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .primary-action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.4);
        }

        /* STORY SECTION - COMPLETELY HIDDEN UNTIL USER READY */
        .story-writing-section {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 32px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .story-writing-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .story-writing-header h3 {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .story-writing-header p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .story-title-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .story-title-input:focus {
            outline: none;
            border-color: #6366F1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .genre-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px;
        }

        .genre-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .genre-card:hover {
            border-color: #667eea;
            transform: translateY(-1px);
        }

        .genre-card.active {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .genre-emoji {
            font-size: 16px;
            display: block;
            margin-bottom: 4px;
        }

        .genre-name {
            color: var(--text-primary);
            font-size: 12px;
            font-weight: 500;
        }

        .word-counter {
            float: right;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 12px;
        }

        .story-input {
            width: 100%;
            min-height: 200px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            color: var(--text-primary);
            font-size: 15px;
            line-height: 1.6;
            resize: vertical;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .story-input:focus {
            outline: none;
            border-color: #6366F1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* MOBILE STYLES */
        @media (max-width: 768px) {
            .dynamic-header {
                left: 0;
                padding: 0 16px;
                height: 70px;
            }

            .header-avatar {
                width: 40px;
                height: 40px;
                margin-right: 12px;
            }

            .header-username {
                font-size: 16px;
            }

            .header-story-title {
                font-size: 13px;
            }

            .header-actions {
                gap: 8px;
            }

            .header-action-btn {
                padding: 6px 12px;
                font-size: 12px;
            }

            .sidebar {
                width: 100%;
                height: 70px;
                position: fixed;
                bottom: 0;
                top: auto;
                padding: 8px 16px;
                background: rgba(10, 10, 10, 0.98);
                backdrop-filter: blur(20px);
                border-top: 1px solid var(--border-color);
                border-right: none;
                z-index: 1000;
                box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.3);
            }

            .logo-section {
                display: none;
            }

            .nav-section {
                display: flex;
                justify-content: space-around;
                align-items: center;
                margin: 0;
                height: 100%;
            }

            .nav-item {
                flex-direction: column;
                padding: 8px 4px;
                margin: 0;
                min-width: 50px;
                text-align: center;
                border-radius: 12px;
            }

            .nav-item.active {
                transform: translateY(-2px);
                background: var(--primary-gradient);
                box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);
            }

            .nav-icon {
                margin: 0 0 2px 0;
                font-size: 16px;
            }

            .nav-text {
                font-size: 9px;
                font-weight: 600;
            }

            .trending-section {
                display: none;
            }

            .main-content {
                margin-left: 0;
                margin-bottom: 70px;
            }

            .main-content.header-visible {
                margin-top: 70px;
            }

            .story-card {
                flex-direction: column;
                min-height: calc(100vh - 70px);
            }
            
            .video-section {
                width: 100%;
                height: 65vh;
                order: 1;
            }

            .video-section.shrunk {
                transform: scale(0.85) translateY(-10%);
                height: 55vh;
            }

            .video-section.shrunk + .story-section {
                width: 100%;
                transform: none;
                height: 45vh;
            }

            .video-container {
                border-radius: 0;
                height: 100%;
            }
            
            .story-section {
                width: 100%;
                height: 35vh;
                border-left: none;
                border-top: 1px solid var(--border-color);
                padding: 16px;
                order: 2;
                overflow-y: auto;
            }

            .create-story-section {
                padding: 16px;
                margin-bottom: 80px;
                max-width: 100%;
            }

            .create-header h1 {
                font-size: 24px;
            }

            .video-prompt-section,
            .video-preview-section,
            .story-writing-section {
                padding: 20px;
                margin-bottom: 16px;
            }

            .video-description-input {
                min-height: 100px;
                font-size: 14px;
                padding: 12px;
            }

            .video-player {
                height: 200px;
                max-width: none;
            }

            .play-button {
                font-size: 32px;
                width: 60px;
                height: 60px;
            }

            .style-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .genre-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 6px;
            }
        }

        /* ENHANCED STORY WRITING INTERFACE */
        .story-composer {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .composer-modal {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 32px;
            width: 95%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            box-shadow: 0 20px 64px rgba(0, 0, 0, 0.5);
        }

        .composer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .composer-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Writing Options Section */
        .writing-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }

        .option-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .option-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .option-pill {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .option-pill:hover {
            background: rgba(255, 255, 255, 0.12);
            color: var(--text-primary);
        }

        .option-pill.active {
            background: var(--primary-gradient);
            color: white;
            border-color: transparent;
        }

        /* Text Editor Section */
        .text-editor-container {
            position: relative;
            margin-bottom: 20px;
        }

        .editor-toolbar {
            display: flex;
            gap: 8px;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 12px 12px 0 0;
            border-bottom: none;
        }

        .toolbar-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .toolbar-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
        }

        .toolbar-btn.active {
            background: var(--primary-gradient);
            color: white;
        }

        .composer-textarea {
            width: 100%;
            min-height: 300px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 0 0 16px 16px;
            padding: 20px;
            color: var(--text-primary);
            font-size: 15px;
            line-height: 1.7;
            resize: vertical;
            font-family: 'Inter', sans-serif;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .composer-textarea:focus {
            outline: none;
            border-color: #6366F1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Word Counter and Stats */
        .writing-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .word-stats {
            display: flex;
            gap: 20px;
            font-size: 13px;
        }

        .stat-item {
            color: var(--text-secondary);
        }

        .stat-number {
            color: var(--text-primary);
            font-weight: 600;
        }

        .word-limit {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .word-limit.warning {
            color: var(--warning-color);
        }

        .word-limit.error {
            color: var(--error-color);
        }

        /* Action Buttons */
        .composer-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .cancel-btn {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border-color);
            color: white;
            padding: 16px;
            border-radius: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cancel-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .publish-btn {
            flex: 2;
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 16px;
            border-radius: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .publish-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 24px rgba(99, 102, 241, 0.4);
        }

        .publish-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .composer-modal {
                padding: 20px;
                margin: 10px;
                max-height: 95vh;
            }

            .writing-options {
                grid-template-columns: 1fr;
                gap: 16px;
                padding: 16px;
            }

            .option-pills {
                gap: 6px;
            }

            .option-pill {
                font-size: 12px;
                padding: 6px 12px;
            }

            .composer-textarea {
                min-height: 250px;
                font-size: 14px;
                padding: 16px;
            }

            .word-stats {
                gap: 12px;
                flex-wrap: wrap;
            }

            .composer-actions {
                flex-direction: column;
            }
        }

        /* Update create story section with enhanced interface */
        .story-writing-section {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 32px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .enhanced-story-input {
            width: 100%;
            min-height: 250px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 0 0 12px 12px;
            padding: 20px;
            color: var(--text-primary);
            font-size: 15px;
            line-height: 1.7;
            resize: vertical;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        .enhanced-story-input:focus {
            outline: none;
            border-color: #6366F1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Scroll indicator for better UX */
        .scroll-progress {
            position: fixed;
            top: 0;
            left: 320px;
            right: 0;
            height: 3px;
            background: rgba(102, 126, 234, 0.1);
            z-index: 300;
            transform: translateZ(0);
            will-change: transform;
        }

        .scroll-progress-bar {
            height: 100%;
            background: var(--primary-gradient);
            width: 0%;
            transition: width 0.3s ease;
            will-change: width;
        }

        @media (max-width: 768px) {
            .scroll-progress {
                left: 0;
            }
        }

        /* SKELETON LOADING ANIMATION */
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }

        .skeleton {
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0.05) 25%,
                rgba(255, 255, 255, 0.1) 37%,
                rgba(255, 255, 255, 0.05) 63%
            );
            background-size: 1000px 100%;
            animation: shimmer 2s infinite linear;
            border-radius: 12px;
        }

        .story-card-skeleton {
            min-height: 100vh;
            display: flex;
            scroll-snap-align: start;
        }

        .video-section-skeleton {
            width: 60%;
            background: var(--card-bg);
            border-radius: 0 24px 24px 0;
        }

        .story-section-skeleton {
            width: 40%;
            padding: 24px;
            background: var(--card-bg);
        }

        .avatar-skeleton {
            width: 48px;
            height: 48px;
            border-radius: 50%;
        }

        .text-skeleton {
            height: 20px;
            margin-bottom: 12px;
        }

        .text-skeleton.short {
            width: 30%;
        }

        .text-skeleton.medium {
            width: 60%;
        }

        .text-skeleton.long {
            width: 90%;
        }

        @media (max-width: 768px) {
            .story-card-skeleton {
                flex-direction: column;
            }

            .video-section-skeleton {
                width: 100%;
                height: 65vh;
                border-radius: 0;
            }

            .story-section-skeleton {
                width: 100%;
                height: 35vh;
            }
        }

        /* SCROLL TO TOP BUTTON */
        .scroll-to-top {
            position: fixed;
            bottom: 90px;
            right: 24px;
            width: 48px;
            height: 48px;
            background: var(--primary-gradient);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }

        .scroll-to-top.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .scroll-to-top:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 24px rgba(102, 126, 234, 0.4);
        }

        @media (max-width: 768px) {
            .scroll-to-top {
                bottom: 80px;
                right: 16px;
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
        }

        /* Update toast colors */
        .toast.success {
            border-left: 4px solid var(--success-color);
        }

        .toast.error {
            border-left: 4px solid var(--error-color);
        }

        /* Update button hover states */
        .action-btn:hover {
            background: var(--glass-bg);
            transform: translateY(-1px);
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.15);
        }

        .primary-action-btn {
            background: var(--primary-gradient);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
        }

        .primary-action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.4);
        }

        /* Update input styles */
        .video-description-input:focus,
        .story-title-input:focus,
        .story-input:focus {
            border-color: #6366F1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        /* Add styles for video preview icon */
        .video-preview-icon {
            font-size: 32px;
            opacity: 0.8;
            transition: all 0.3s ease;
        }

        .video-section:hover .video-preview-icon {
            transform: scale(1.05); /* Reduced scale effect */
            opacity: 1;
        }

        /* Toast and Heart Animation Keyframes */
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @keyframes heartPop {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.3);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1) translateY(-20px);
                opacity: 0;
            }
        }

        /* Reduced Motion Preferences */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.001ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.001ms !important;
                scroll-behavior: auto !important;
            }
        }

        .main-feed {
            height: 100vh;
            overflow-y: scroll;
            scroll-snap-type: none; /* Removed snap scrolling */
            scrollbar-width: none;
            scroll-behavior: smooth;
        }

        .video-section {
            width: 60%;
            position: relative;
            background: #111;
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            transform-origin: center center;
            will-change: transform;
            opacity: 0.95;
        }

        .video-section.shrunk {
            transform: scale(0.98) translateX(-2%); /* Even gentler transform */
            border-radius: 16px;
            opacity: 0.85;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .story-section {
            width: 40%;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            padding: 24px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            border-left: 1px solid var(--border-color);
            transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            opacity: 0.9;
        }

        .video-section.shrunk + .story-section {
            width: 42%; /* Minimal width change */
            transform: translateX(-1%); /* Minimal movement */
            opacity: 1;
        }

        /* Smoother header transitions */
        .dynamic-header {
            transform: translateY(0);
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
        }

        .dynamic-header.visible {
            opacity: 1;
            pointer-events: all;
        }

        /* Gentler hover effects */
        .action-btn:hover {
            transform: translateY(-1px);
            background: var(--glass-bg);
        }

        .primary-action-btn:hover {
            transform: translateY(-1px);
        }

        .video-preview-icon {
            transition: transform 0.4s ease;
        }

        .video-section:hover .video-preview-icon {
            transform: scale(1.05); /* Reduced scale effect */
        }

        /* Update scroll progress to be more subtle */
        .scroll-progress {
            opacity: 0.7;
        }

        .scroll-progress-bar {
            transition: width 0.4s ease;
        }

        /* Dynamic Content Styles */
        .video-thumbnail {
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .video-thumbnail:hover {
            transform: scale(1.02);
            filter: brightness(1.1);
        }

        .author-avatar {
            transition: all 0.3s ease;
        }

        .author-avatar[src=""] {
            display: none !important;
        }

        #authorAvatarFallback_1,
        #authorAvatarFallback_2,
        #authorAvatarFallback_3 {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--secondary-gradient);
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        /* Dynamic interaction states */
        .action-btn[data-action] {
            transition: all 0.3s ease;
        }

        .action-btn[data-action="like"].liked {
            color: #ff6b6b;
            transform: scale(1.05);
        }

        .action-btn[data-action="comment"]:hover {
            color: #4ecdc4;
        }

        .action-btn[data-action="share"]:hover {
            color: #45b7d1;
        }

        /* Story chain visibility control */
        .story-chain[style*="display: none"] {
            display: none !important;
        }

        /* Video prompt visibility control */
        .video-prompt[style*="display: none"] {
            display: none !important;
        }

        /* STORY DETAIL MODAL STYLES */
        .story-detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            z-index: 2000;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .story-detail-modal.active {
            display: block;
            opacity: 1;
        }

        .detail-modal-content {
            width: 100%;
            height: 100vh;
            overflow-y: auto;
            background: var(--dark-bg);
            scrollbar-width: none;
        }

        .detail-modal-content::-webkit-scrollbar {
            display: none;
        }

        .detail-header {
            position: sticky;
            top: 0;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 10;
        }

        .back-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 24px;
            font-weight: 600;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .back-btn:hover {
            background: var(--glass-bg);
        }

        .detail-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
            text-align: center;
        }

        .detail-share-btn {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: background 0.3s ease;
        }

        .detail-share-btn:hover {
            background: var(--glass-bg);
        }

        .detail-video-section {
            position: relative;
            height: 50vh;
            background: #111;
        }

        .detail-video-container {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .detail-video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .detail-video-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--dark-bg) 0%, rgba(16, 17, 22, 0.95) 100%);
        }

        .detail-video-placeholder .video-preview-icon {
            font-size: 48px;
            opacity: 0.8;
        }

        .detail-video-overlay {
            position: absolute;
            top: 20px;
            right: 20px;
        }

        .detail-story-section {
            padding: 24px;
            max-width: 800px;
            margin: 0 auto;
        }

        .detail-author-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .detail-author-info {
            display: flex;
            align-items: center;
        }

        .detail-author-avatar,
        .detail-author-avatar-fallback {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            margin-right: 16px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        .detail-author-avatar-fallback {
            background: var(--secondary-gradient);
        }

        .detail-author-text h3 {
            color: var(--text-primary);
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .detail-author-text span {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .follow-author-btn {
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);
        }

        .follow-author-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .detail-story-content {
            margin-bottom: 32px;
        }

        .detail-genre-tag {
            background: var(--accent-gradient);
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 20px;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-story-title {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 24px;
            line-height: 1.2;
        }

        .detail-story-text {
            font-size: 18px;
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 32px;
        }

        .detail-story-text p {
            margin-bottom: 20px;
        }

        .detail-story-chains {
            margin-top: 32px;
        }

        .detail-chain-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            position: relative;
        }

        .detail-chain-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--accent-gradient);
            border-radius: 0 2px 2px 0;
        }

        .detail-chain-author {
            font-size: 14px;
            color: #4ecdc4;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .detail-chain-text {
            font-size: 16px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
        }

        .detail-actions {
            padding-top: 24px;
            border-top: 1px solid var(--border-color);
        }

        .detail-stats {
            display: flex;
            gap: 24px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .detail-action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 12px 16px;
            border-radius: 12px;
        }

        .detail-action-btn:hover {
            color: var(--text-primary);
            background: var(--glass-bg);
            transform: translateY(-1px);
        }

        .detail-action-btn.liked {
            color: #ff6b6b;
        }

        .detail-continue-btn {
            width: 100%;
            background: var(--primary-gradient);
            border: none;
            color: white;
            padding: 18px;
            border-radius: 16px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
        }

        .detail-continue-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 32px rgba(99, 102, 241, 0.4);
        }

        /* Mobile Responsive for Detail Modal */
        @media (max-width: 768px) {
            .detail-header {
                padding: 12px 16px;
            }

            .detail-video-section {
                height: 40vh;
            }

            .detail-story-section {
                padding: 20px 16px;
            }

            .detail-author-avatar,
            .detail-author-avatar-fallback {
                width: 56px;
                height: 56px;
                margin-right: 12px;
            }

            .detail-author-text h3 {
                font-size: 18px;
            }

            .detail-story-title {
                font-size: 24px;
                margin-bottom: 20px;
            }

            .detail-story-text {
                font-size: 16px;
                line-height: 1.7;
            }

            .detail-stats {
                gap: 16px;
                flex-wrap: wrap;
            }

            .follow-author-btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <button class="scroll-to-top" id="scrollTopBtn" onclick="scrollToTop()"></button>
    <div class="app-container">
        <!-- Dynamic Header -->
        <div class="dynamic-header" id="dynamicHeader">
            <div class="header-avatar" id="headerAvatar"></div>
            <div class="header-info">
                <div class="header-username" id="headerUsername">@storyteller_maya</div>
                <div class="header-story-title" id="headerStoryTitle">The Cabin's Secret</div>
            </div>
            <div class="header-actions">
                <button class="header-action-btn" onclick="followUser()">Follow</button>
                <button class="header-action-btn" onclick="shareStory()">Share</button>
            </div>
        </div>

        <!-- Scroll Progress Bar -->
        <div class="scroll-progress">
            <div class="scroll-progress-bar" id="scrollProgressBar"></div>
        </div>

        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <div class="logo-section">
                <div class="logo">VS</div>
                <div class="logo-text">VisualStory</div>
            </div>
            
            <div class="nav-section">
                <div class="nav-item active" onclick="showFeed()">
                    <span class="nav-icon"></span>
                    <span class="nav-text">Home</span>
                </div>
                <div class="nav-item" onclick="showTrending()">
                    <span class="nav-icon"></span>
                    <span class="nav-text">Trending</span>
                </div>
                <div class="nav-item" onclick="showCreateStory()">
                    <span class="nav-icon"></span>
                    <span class="nav-text">Create</span>
                </div>
                <div class="nav-item" onclick="showProfile()">
                    <span class="nav-icon"></span>
                    <span class="nav-text">Profile</span>
                </div>
            </div>

            <div class="trending-section">
                <div class="trending-title"> Trending Now</div>
                <div class="trending-item">
                    <div class="trending-number">1</div>
                    <div class="trending-text">#HorrorChallenge</div>
                </div>
                <div class="trending-item">
                    <div class="trending-number">2</div>
                    <div class="trending-text">#LoveStories</div>
                </div>
                <div class="trending-item">
                    <div class="trending-number">3</div>
                    <div class="trending-text">#PlotTwist</div>
                </div>
                <div class="trending-item">
                    <div class="trending-number">4</div>
                    <div class="trending-text">#AIArt</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <!-- Main Feed - Foundation for Infinite Scrolling -->
            <div class="main-feed" id="mainFeed">
                <!-- Scroll Trigger for Infinite Loading -->
                <div class="scroll-trigger" id="scrollTrigger"></div>
                
                <!-- Story Card 1 - Dynamic Data Structure -->
                <div class="story-card" data-story-id="1">
                    <div class="video-section">
                        <div class="video-container">
                            <div class="ai-video">
                                <!-- Video thumbnail or video element for dynamic content -->
                                <img class="video-thumbnail" id="videoThumbnail_1" src="" alt="AI Generated Video" style="display: none; width: 100%; height: 100%; object-fit: cover;">
                                <!-- Fallback video preview icon -->
                                <div style="position: relative; z-index: 5;">
                                    <span class="video-preview-icon"></span>
                                </div>
                            </div>
                            <div class="video-overlay">
                                <div class="ai-badge">AI Generated </div>
                                <div class="video-prompt" id="videoPrompt_1" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="story-section">
                        <div class="story-header">
                            <img class="author-avatar" id="authorAvatar_1" src="" alt="Author Avatar" style="display: none;">
                            <div class="author-avatar" id="authorAvatarFallback_1"></div>
                            <div class="author-info">
                                <h4 id="authorUsername_1">@storyteller_maya</h4>
                                <span id="authorMeta_1">2h ago   Trending</span>
                            </div>
                        </div>
                        <div class="story-content">
                            <div class="genre-tag" id="genreTag_1">Horror</div>
                            <div class="story-title" id="storyTitle_1">The Cabin's Secret</div>
                            <div class="story-text" id="storyText_1">
                                As Ava stepped into the cabin, her flashlight flickered. Something was dripping in the corner. She turnedand saw the rocking chair moving on its own. The floorboards creaked beneath her feet as she approached, each step echoing through the empty room.
                            </div>
                            <div class="story-chain" id="storyChain_1">
                                <div class="chain-author" id="chainAuthor_1">@horror_enthusiast continued:</div>
                                <div class="story-text" id="chainText_1">
                                    The chair stopped suddenly. In the silence, Ava heard breathing that wasn't her own. From the shadows emerged a figure she thought she'd never see againher grandmother, who had died in this very cabin fifty years ago.
                                </div>
                            </div>
                        </div>
                        <div class="story-actions">
                            <button class="action-btn liked" data-action="like" data-story-id="1" onclick="toggleLike(this)">
                                 <span id="likesCount_1">234</span>
                            </button>
                            <button class="action-btn" data-action="comment" data-story-id="1">
                                 <span id="commentsCount_1">67</span>
                            </button>
                            <button class="action-btn" data-action="share" data-story-id="1">
                                 <span>Share</span>
                            </button>
                        </div>
                        <button class="continue-story-btn" data-action="continue" data-story-id="1" onclick="openComposer('The Cabin\u0027s Secret')">
                             Continue This Story
                        </button>
                    </div>
                </div>

                <!-- Story Card 2 - Dynamic Data Structure -->
                <div class="story-card" data-story-id="2">
                    <div class="video-section">
                        <div class="video-container">
                            <div class="ai-video">
                                <!-- Video thumbnail or video element for dynamic content -->
                                <img class="video-thumbnail" id="videoThumbnail_2" src="" alt="AI Generated Video" style="display: none; width: 100%; height: 100%; object-fit: cover;">
                                <!-- Fallback video preview icon -->
                                <div style="position: relative; z-index: 5;">
                                    <span class="video-preview-icon"></span>
                                </div>
                            </div>
                            <div class="video-overlay">
                                <div class="ai-badge">AI Generated </div>
                                <div class="video-prompt" id="videoPrompt_2" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="story-section">
                        <div class="story-header">
                            <img class="author-avatar" id="authorAvatar_2" src="" alt="Author Avatar" style="display: none;">
                            <div class="author-avatar" id="authorAvatarFallback_2"></div>
                            <div class="author-info">
                                <h4 id="authorUsername_2">@romantic_writer</h4>
                                <span id="authorMeta_2">4h ago   Loved</span>
                            </div>
                        </div>
                        <div class="story-content">
                            <div class="genre-tag" id="genreTag_2">Romance</div>
                            <div class="story-title" id="storyTitle_2">Coffee Shop Confessions</div>
                            <div class="story-text" id="storyText_2">
                                Emma stirred her latte nervously as Jake sat across from her. After five years of friendship, this moment felt different. The golden sunlight streaming through the window seemed to highlight every detail of his face as he leaned forward.
                            </div>
                            <div class="story-text" id="storyTextContinuation_2">
                                "There's something I need to tell you," he began, his voice barely above a whisper. "Something I should have said years ago..."
                            </div>
                            <!-- Story chain container for dynamic chains -->
                            <div class="story-chain" id="storyChain_2" style="display: none;">
                                <div class="chain-author" id="chainAuthor_2"></div>
                                <div class="story-text" id="chainText_2"></div>
                            </div>
                        </div>
                        <div class="story-actions">
                            <button class="action-btn" data-action="like" data-story-id="2" onclick="toggleLike(this)">
                                 <span id="likesCount_2">891</span>
                            </button>
                            <button class="action-btn" data-action="comment" data-story-id="2">
                                 <span id="commentsCount_2">203</span>
                            </button>
                            <button class="action-btn" data-action="share" data-story-id="2">
                                 <span>Share</span>
                            </button>
                        </div>
                        <button class="continue-story-btn" data-action="continue" data-story-id="2" onclick="openComposer('Coffee Shop Confessions')">
                             Continue This Story
                        </button>
                    </div>
                </div>

                <!-- Story Card 3 - Dynamic Data Structure -->
                <div class="story-card" data-story-id="3">
                    <div class="video-section">
                        <div class="video-container">
                            <div class="ai-video">
                                <!-- Video thumbnail or video element for dynamic content -->
                                <img class="video-thumbnail" id="videoThumbnail_3" src="" alt="AI Generated Video" style="display: none; width: 100%; height: 100%; object-fit: cover;">
                                <!-- Fallback video preview icon -->
                                <div style="position: relative; z-index: 5;">
                                    <span class="video-preview-icon"></span>
                                </div>
                            </div>
                            <div class="video-overlay">
                                <div class="ai-badge">AI Generated </div>
                                <div class="video-prompt" id="videoPrompt_3" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="story-section">
                        <div class="story-header">
                            <img class="author-avatar" id="authorAvatar_3" src="" alt="Author Avatar" style="display: none;">
                            <div class="author-avatar" id="authorAvatarFallback_3"></div>
                            <div class="author-info">
                                <h4 id="authorUsername_3">@sci_fi_dreamer</h4>
                                <span id="authorMeta_3">6h ago   Viral</span>
                            </div>
                        </div>
                        <div class="story-content">
                            <div class="genre-tag" id="genreTag_3">Sci-Fi</div>
                            <div class="story-title" id="storyTitle_3">Digital Awakening</div>
                            <div class="story-text" id="storyText_3">
                                Maya's neural implant buzzed as she walked through Neo-Tokyo's neon-lit streets. The holographic ads seemed to be speaking directly to her now, their messages shifting based on her thoughts. Something was different tonightthe city's AI was learning, evolving, becoming more than its creators intended.
                            </div>
                            <div class="story-text" id="storyTextContinuation_3">
                                A message flickered across her vision: "Ready to see the truth, Maya?"
                            </div>
                            <!-- Story chain container for dynamic chains -->
                            <div class="story-chain" id="storyChain_3" style="display: none;">
                                <div class="chain-author" id="chainAuthor_3"></div>
                                <div class="story-text" id="chainText_3"></div>
                            </div>
                        </div>
                        <div class="story-actions">
                            <button class="action-btn" data-action="like" data-story-id="3" onclick="toggleLike(this)">
                                 <span id="likesCount_3">1.2k</span>
                            </button>
                            <button class="action-btn" data-action="comment" data-story-id="3">
                                 <span id="commentsCount_3">342</span>
                            </button>
                            <button class="action-btn" data-action="share" data-story-id="3">
                                 <span>Share</span>
                            </button>
                        </div>
                        <button class="continue-story-btn" data-action="continue" data-story-id="3" onclick="openComposer('Digital Awakening')">
                             Continue This Story
                        </button>
                    </div>
                </div>

                <!-- Loading Spinner for Infinite Scroll -->
                <div class="loading-spinner" id="loadingSpinner"></div>
                
                <!-- End of Feed Message -->
                <div class="end-of-feed" id="endOfFeed">
                    <p> You've reached the end! Create your own story to see more content.</p>
                </div>
            </div>

            <!-- CREATE PAGE - VIDEO FIRST -->
            <div class="create-story-section" id="createStorySection" style="display: none;">
                <div class="create-header">
                    <h1>Create Video Story</h1>
                    <p>Start by describing your video, then write a story about it </p>
                </div>
                
                <!-- VIDEO PROMPT SECTION - ONLY THING VISIBLE INITIALLY -->
                <div class="video-prompt-section">
                    <div class="prompt-header">
                        <h2> Describe Your Video</h2>
                        <p>What video do you want to create?</p>
                    </div>
                    
                    <div class="input-group">
                        <label>Video Description</label>
                        <textarea class="video-description-input" 
                            placeholder="Describe your video in detail...

Examples:
 A cozy coffee shop at sunset with two people talking
 A mysterious figure walking through a foggy forest
 Two friends laughing on a city rooftop at night
 A cat exploring an enchanted garden with magical elements"
                            id="videoDescription"></textarea>
                    </div>

                    <div class="input-group">
                        <label>Visual Style</label>
                        <div class="style-grid">
                            <div class="style-card active" data-style="cinematic">
                                <div class="style-preview"></div>
                                <div class="style-name">Cinematic</div>
                            </div>
                            <div class="style-card" data-style="artistic">
                                <div class="style-preview"></div>
                                <div class="style-name">Artistic</div>
                            </div>
                            <div class="style-card" data-style="realistic">
                                <div class="style-preview"></div>
                                <div class="style-name">Realistic</div>
                            </div>
                            <div class="style-card" data-style="dreamy">
                                <div class="style-preview"></div>
                                <div class="style-name">Dreamy</div>
                            </div>
                        </div>
                    </div>

                    <button class="create-video-btn" onclick="generateAIVideo()">
                        <span class="btn-icon"></span>
                        Create Video
                    </button>
                </div>

                <!-- VIDEO PREVIEW SECTION - HIDDEN UNTIL VIDEO CREATED -->
                <div class="video-preview-section" id="videoPreviewSection" style="display: none;">
                    <div class="preview-header">
                        <h3> Your Video is Ready!</h3>
                        <p>Review your video below</p>
                    </div>
                    
                    <div class="video-player" id="videoPlayer">
                        <div class="video-content">
                            <div class="play-button" onclick="playVideo()"></div>
                            <div class="video-info" id="videoInfo">Your AI Generated Video</div>
                        </div>
                    </div>
                    
                    <div class="video-actions">
                        <button class="video-action-btn" onclick="regenerateVideo()">
                             Regenerate
                        </button>
                        <button class="video-action-btn" onclick="editVideoPrompt()">
                             Edit Prompt
                        </button>
                    </div>

                    <div class="proceed-to-story">
                        <p>Happy with your video? Now write a story about it!</p>
                        <button class="primary-action-btn" onclick="showStorySection()">
                            <span class="btn-icon"></span>
                            Write My Story
                        </button>
                    </div>
                </div>

                <!-- STORY SECTION - COMPLETELY HIDDEN UNTIL USER CLICKS "WRITE MY STORY" -->
                <div class="story-writing-section" id="storySection" style="display: none;">
                    <div class="story-writing-header">
                        <h3> Write Your Story</h3>
                        <p>Based on your video above, tell us the story</p>
                    </div>
                    
                    <div class="input-group">
                        <label>Story Title</label>
                        <input type="text" class="story-title-input" 
                            placeholder="Give your story a compelling title..." 
                            id="storyTitle">
                    </div>

                    <!-- Enhanced Writing Options for Create -->
                    <div class="writing-options">
                        <div class="option-group">
                            <div class="option-label">Point of View</div>
                            <div class="option-pills" id="createPovOptions">
                                <div class="option-pill active" data-pov="first">First Person</div>
                                <div class="option-pill" data-pov="third">Third Person</div>
                                <div class="option-pill" data-pov="character">Character Focus</div>
                            </div>
                        </div>
                        
                        <div class="option-group">
                            <div class="option-label">Tone & Style</div>
                            <div class="option-pills" id="createToneOptions">
                                <div class="option-pill active" data-tone="neutral">Neutral</div>
                                <div class="option-pill" data-tone="eerie">Eerie</div>
                                <div class="option-pill" data-tone="sweet">Sweet</div>
                                <div class="option-pill" data-tone="thriller">Thriller</div>
                                <div class="option-pill" data-tone="satire">Satire</div>
                            </div>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>Genre</label>
                        <div class="genre-grid">
                            <div class="genre-card active" data-genre="drama">
                                <span class="genre-emoji"></span>
                                <span class="genre-name">Drama</span>
                            </div>
                            <div class="genre-card" data-genre="horror">
                                <span class="genre-emoji"></span>
                                <span class="genre-name">Horror</span>
                            </div>
                            <div class="genre-card" data-genre="romance">
                                <span class="genre-emoji"></span>
                                <span class="genre-name">Romance</span>
                            </div>
                            <div class="genre-card" data-genre="mystery">
                                <span class="genre-emoji"></span>
                                <span class="genre-name">Mystery</span>
                            </div>
                            <div class="genre-card" data-genre="comedy">
                                <span class="genre-emoji"></span>
                                <span class="genre-name">Comedy</span>
                            </div>
                            <div class="genre-card" data-genre="scifi">
                                <span class="genre-emoji"></span>
                                <span class="genre-name">Sci-Fi</span>
                            </div>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="text-editor-container">
                            <div class="editor-toolbar">
                                <button class="toolbar-btn" onclick="formatCreateText('bold')" title="Bold">
                                    <strong>B</strong>
                                </button>
                                <button class="toolbar-btn" onclick="formatCreateText('italic')" title="Italic">
                                    <em>I</em>
                                </button>
                                <button class="toolbar-btn" onclick="insertCreateQuote()" title="Add Quote">
                                    " "
                                </button>
                            </div>
                            <textarea class="enhanced-story-input" 
                                placeholder="Watch your video above and tell us the story...

What's happening in this scene?
Who are these characters and what are they thinking?
What led to this moment?
What happens next?

Describe what you see and bring it to life with your words!"
                                id="storyContent"
                                maxlength="1000"></textarea>
                        </div>
                        
                        <div class="writing-stats">
                            <div class="word-stats">
                                <div class="stat-item">
                                    Words: <span class="stat-number" id="createWordCount">0</span>
                                </div>
                                <div class="stat-item">
                                    Characters: <span class="stat-number" id="createCharCount">0</span>
                                </div>
                            </div>
                            <div class="word-limit" id="createWordLimit">1000 words max</div>
                        </div>
                    </div>

                    <button class="primary-action-btn" onclick="publishVideoStory()">
                        <span class="btn-icon"></span>
                        Publish Video Story
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Story Composer Modal -->
    <div class="story-composer" id="storyComposer">
        <div class="composer-modal">
            <div class="composer-header">
                <div class="composer-title">Continue: <span id="storyTitleDisplay"></span></div>
                <button class="close-btn" onclick="closeComposer()">&times;</button>
            </div>
            
            <!-- Writing Options -->
            <div class="writing-options">
                <div class="option-group">
                    <div class="option-label">Point of View</div>
                    <div class="option-pills" id="povOptions">
                        <div class="option-pill active" data-pov="first">First Person (I)</div>
                        <div class="option-pill" data-pov="third">Third Person (They)</div>
                        <div class="option-pill" data-pov="character">Character Focus</div>
                    </div>
                </div>
                
                <div class="option-group">
                    <div class="option-label">Tone & Style</div>
                    <div class="option-pills" id="toneOptions">
                        <div class="option-pill active" data-tone="neutral">Neutral</div>
                        <div class="option-pill" data-tone="eerie">Eerie</div>
                        <div class="option-pill" data-tone="sweet">Sweet</div>
                        <div class="option-pill" data-tone="thriller">Thriller</div>
                        <div class="option-pill" data-tone="satire">Satire</div>
                    </div>
                </div>
            </div>
            
            <!-- Text Editor -->
            <div class="text-editor-container">
                <div class="editor-toolbar">
                    <button class="toolbar-btn" onclick="formatText('bold')" title="Bold">
                        <strong>B</strong>
                    </button>
                    <button class="toolbar-btn" onclick="formatText('italic')" title="Italic">
                        <em>I</em>
                    </button>
                    <button class="toolbar-btn" onclick="formatText('underline')" title="Underline">
                        <u>U</u>
                    </button>
                    <button class="toolbar-btn" onclick="insertQuote()" title="Add Quote">
                        " "
                    </button>
                    <button class="toolbar-btn" onclick="insertDialogue()" title="Add Dialogue">
                        
                    </button>
                </div>
                <textarea class="composer-textarea" 
                    placeholder="Continue the story... What happens next? Let your imagination flow! " 
                    id="storyTextarea"
                    maxlength="1000"></textarea>
            </div>
            
            <!-- Writing Stats -->
            <div class="writing-stats">
                <div class="word-stats">
                    <div class="stat-item">
                        Words: <span class="stat-number" id="wordCount">0</span>
                    </div>
                    <div class="stat-item">
                        Characters: <span class="stat-number" id="charCount">0</span>
                    </div>
                    <div class="stat-item">
                        Reading time: <span class="stat-number" id="readingTime">0 min</span>
                    </div>
                </div>
                <div class="word-limit" id="wordLimit">1000 words max</div>
            </div>
            
            <!-- Actions -->
            <div class="composer-actions">
                <button class="cancel-btn" onclick="closeComposer()">Cancel</button>
                <button class="publish-btn" onclick="publishStory()" id="publishBtn">
                    <span></span>
                    Publish Continuation
                </button>
            </div>
        </div>
    </div>

    <!-- Story Detail Modal -->
    <div class="story-detail-modal" id="storyDetailModal">
        <div class="detail-modal-content">
            <div class="detail-header">
                <button class="back-btn" onclick="closeStoryDetail()"></button>
                <div class="detail-title" id="detailTitle">Story Details</div>
                <button class="detail-share-btn" onclick="shareCurrentStory()"></button>
            </div>
            
            <div class="detail-video-section" id="detailVideoSection">
                <div class="detail-video-container">
                    <img class="detail-video-thumbnail" id="detailVideoThumbnail" src="" alt="Story Video" style="display: none;">
                    <div class="detail-video-placeholder" id="detailVideoPlaceholder">
                        <span class="video-preview-icon"></span>
                    </div>
                </div>
                <div class="detail-video-overlay">
                    <div class="ai-badge">AI Generated </div>
                </div>
            </div>
            
            <div class="detail-story-section">
                <div class="detail-author-header">
                    <div class="detail-author-info">
                        <img class="detail-author-avatar" id="detailAuthorAvatar" src="" alt="Author" style="display: none;">
                        <div class="detail-author-avatar-fallback" id="detailAuthorAvatarFallback"></div>
                        <div class="detail-author-text">
                            <h3 id="detailAuthorUsername">@username</h3>
                            <span id="detailAuthorMeta">2h ago   Trending</span>
                        </div>
                    </div>
                    <button class="follow-author-btn" onclick="followAuthor()">Follow</button>
                </div>
                
                <div class="detail-story-content">
                    <div class="detail-genre-tag" id="detailGenreTag">Genre</div>
                    <h2 class="detail-story-title" id="detailStoryTitle">Story Title</h2>
                    
                    <div class="detail-story-text" id="detailStoryText">
                        <!-- Full story content will be loaded here -->
                    </div>
                    
                    <div class="detail-story-chains" id="detailStoryChains">
                        <!-- Story continuations will be loaded here -->
                    </div>
                </div>
                
                <div class="detail-actions">
                    <div class="detail-stats">
                        <button class="detail-action-btn" id="detailLikeBtn" onclick="toggleDetailLike()">
                             <span id="detailLikesCount">0</span>
                        </button>
                        <button class="detail-action-btn" onclick="showComments()">
                             <span id="detailCommentsCount">0</span>
                        </button>
                        <button class="detail-action-btn" onclick="shareDetailStory()">
                             Share
                        </button>
                    </div>
                    <button class="detail-continue-btn" onclick="continueDetailStory()">
                         Continue This Story
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let hasGeneratedVideo = false;
        let videoData = {};
        let storyData = {};
        let lastScrollY = 0;
        let isScrollingUp = false;
        let currentStoryIndex = 0;

        // Story data for header updates
        const storyCards = [
            { author: '@storyteller_maya', title: 'The Cabin\'s Secret' },
            { author: '@romantic_writer', title: 'Coffee Shop Confessions' },
            { author: '@sci_fi_dreamer', title: 'Digital Awakening' }
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeStyleCards();
            initializeGenreCards();
            initializeScrollHandling();
            initializeDoubleTapLike();
            initializeWritingInterface();
            initializeScrollToTop();
            initializeStoryCardClicks();
        });

        // Initialize scroll to top button
        function initializeScrollToTop() {
            const scrollTopBtn = document.getElementById('scrollTopBtn');
            const mainFeed = document.getElementById('mainFeed');
            
            if (scrollTopBtn && mainFeed) {
                mainFeed.addEventListener('scroll', function() {
                    if (this.scrollTop > 300) {
                        scrollTopBtn.classList.add('visible');
                    } else {
                        scrollTopBtn.classList.remove('visible');
                    }
                });
            }
        }

        // Initialize story card click handlers
        function initializeStoryCardClicks() {
            const mainFeed = document.querySelector('.main-feed');
            
            if (mainFeed) {
                mainFeed.addEventListener('click', function(e) {
                    const storyCard = e.target.closest('.story-card');
                    
                    // Check if click is on the story card but not on action buttons
                    if (storyCard && 
                        !e.target.closest('.action-btn') && 
                        !e.target.closest('.continue-story-btn') &&
                        !e.target.closest('.ai-badge') &&
                        !e.target.closest('.video-overlay')) {
                        
                        const storyId = storyCard.dataset.storyId;
                        showStoryDetail(storyId);
                    }
                });
            }
        }

        // Initialize scroll handling
        function initializeScrollHandling() {
            const mainFeed = document.getElementById('mainFeed');
            
            mainFeed.addEventListener('scroll', handleScroll);
            
            // Initialize with first story
            updateHeader(0);
        }

        // Handle scroll events with reduced motion
        function handleScroll() {
            const mainFeed = document.getElementById('mainFeed');
            const scrollY = mainFeed.scrollTop;
            const feedHeight = mainFeed.scrollHeight - mainFeed.clientHeight;
            
            // Debounce scroll updates with longer delay
            if (!mainFeed.scrollTimeout) {
                mainFeed.scrollTimeout = setTimeout(() => {
                    updateScrollProgress(scrollY, feedHeight);
                    mainFeed.scrollTimeout = null;
                }, 20);
            }
            
            // Determine scroll direction with larger threshold
            const newScrollY = mainFeed.scrollTop;
            isScrollingUp = newScrollY < lastScrollY;
            
            // Only update if scroll difference is more significant
            if (Math.abs(newScrollY - lastScrollY) > 100) {
                lastScrollY = newScrollY;
                
                const storyHeight = window.innerHeight;
                const newStoryIndex = Math.floor((scrollY + (storyHeight * 0.4)) / storyHeight);
                
                if (newStoryIndex !== currentStoryIndex && newStoryIndex < storyCards.length) {
                    currentStoryIndex = newStoryIndex;
                    updateHeader(currentStoryIndex);
                }
            }
            
            // Smoother header visibility
            const dynamicHeader = document.getElementById('dynamicHeader');
            const mainContent = document.getElementById('mainContent');
            
            if (scrollY > 200) {
                if (!dynamicHeader.classList.contains('visible')) {
                    dynamicHeader.classList.add('visible');
                    mainContent.classList.add('header-visible');
                }
            } else if (scrollY < 100) {
                dynamicHeader.classList.remove('visible');
                mainContent.classList.remove('header-visible');
            }
            
            // Throttle video scaling updates
            if (!mainFeed.scaleTimeout) {
                mainFeed.scaleTimeout = setTimeout(() => {
                    requestAnimationFrame(() => {
                        applyVideoScaling(scrollY);
                    });
                    mainFeed.scaleTimeout = null;
                }, 50);
            }
        }

        // Update scroll progress bar
        function updateScrollProgress(scrollY, feedHeight) {
            const progressBar = document.getElementById('scrollProgressBar');
            const progress = (scrollY / feedHeight) * 100;
            progressBar.style.width = `${Math.min(progress, 100)}%`;
        }

        // Update header with current story info
        function updateHeader(storyIndex) {
            if (storyIndex >= 0 && storyIndex < storyCards.length) {
                const story = storyCards[storyIndex];
                const headerUsername = document.getElementById('headerUsername');
                const headerStoryTitle = document.getElementById('headerStoryTitle');
                
                // Animate the update
                headerUsername.style.opacity = '0';
                headerStoryTitle.style.opacity = '0';
                
                setTimeout(() => {
                    headerUsername.textContent = story.author;
                    headerStoryTitle.textContent = story.title;
                    headerUsername.style.opacity = '1';
                    headerStoryTitle.style.opacity = '1';
                }, 150);
            }
        }

        // Even gentler video scaling
        function applyVideoScaling(scrollY) {
            const storyCards = document.querySelectorAll('.story-card');
            const viewportHeight = window.innerHeight;
            
            storyCards.forEach((card, index) => {
                const videoSection = card.querySelector('.video-section');
                const cardTop = index * viewportHeight;
                const cardCenter = cardTop + (viewportHeight / 2);
                
                const distanceFromCenter = Math.abs(scrollY + (viewportHeight / 2) - cardCenter);
                const maxDistance = viewportHeight * 0.8; // Even larger threshold
                const visibility = Math.max(0, 1 - (distanceFromCenter / maxDistance));
                
                if (visibility < 0.3 && isScrollingUp) {
                    if (!videoSection.classList.contains('shrunk')) {
                        videoSection.classList.add('shrunk');
                    }
                } else if (visibility > 0.2) {
                    videoSection.classList.remove('shrunk');
                }
            });
        }

        // Header action functions
        function followUser() {
            const currentStory = storyCards[currentStoryIndex];
            alert(`Following ${currentStory.author}! `);
        }

        function shareStory() {
            const currentStory = storyCards[currentStoryIndex];
            alert(`Sharing "${currentStory.title}" by ${currentStory.author}! `);
        }

        // Style card selection
        function initializeStyleCards() {
            const styleCards = document.querySelectorAll('.style-card');
            styleCards.forEach(card => {
                card.addEventListener('click', function() {
                    styleCards.forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }

        // Genre card selection
        function initializeGenreCards() {
            const genreCards = document.querySelectorAll('.genre-card');
            genreCards.forEach(card => {
                card.addEventListener('click', function() {
                    genreCards.forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }

        // AI Video Generation - ONLY requires video description
        function generateAIVideo() {
            const description = document.getElementById('videoDescription').value;
            const style = document.querySelector('.style-card.active')?.dataset.style || 'cinematic';
            
            if (!description.trim()) {
                alert('Please describe the video you want to create! ');
                document.getElementById('videoDescription').focus();
                return;
            }

            const generateBtn = document.querySelector('.create-video-btn');
            const originalText = generateBtn.innerHTML;
            generateBtn.innerHTML = '<span class="btn-icon"></span>Creating Your Video...';
            generateBtn.disabled = true;
            
            // Simulate AI video generation
            setTimeout(() => {
                // Store video data
                videoData = {
                    description: description,
                    style: style,
                    type: 'ai',
                    prompt: `${description} in ${style} style`
                };
                
                // Show video preview section
                showVideoPreview();
                
                generateBtn.innerHTML = originalText;
                generateBtn.disabled = false;
                
                hasGeneratedVideo = true;
                
                alert(' Video created! Review it and write your story when ready.');
            }, 3000);
        }

        // Show video preview after generation
        function showVideoPreview() {
            const videoPreviewSection = document.getElementById('videoPreviewSection');
            const videoInfo = document.getElementById('videoInfo');
            
            videoInfo.textContent = `${videoData.description.substring(0, 60)}...`;
            
            videoPreviewSection.style.display = 'block';
            videoPreviewSection.style.animation = 'fadeInUp 0.6s ease';
            
            // Keep story section hidden
            document.getElementById('storySection').style.display = 'none';
        }

        // Show story section when user clicks "Write My Story"
        function showStorySection() {
            if (!hasGeneratedVideo) {
                alert('Please create a video first! ');
                return;
            }
            
            const storySection = document.getElementById('storySection');
            storySection.style.display = 'block';
            storySection.style.animation = 'fadeInUp 0.6s ease';
            
            // Initialize word counter
            initializeWordCounter();
            
            // Scroll to story section
            setTimeout(() => {
                storySection.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 300);
            
            // Focus on title input
            setTimeout(() => {
                document.getElementById('storyTitle').focus();
            }, 600);
        }

        // Initialize word counter
        function initializeWordCounter() {
            const textarea = document.getElementById('storyContent');
            const wordCounter = document.querySelector('.word-counter');
            
            if (textarea && wordCounter) {
                textarea.addEventListener('input', function() {
                    const words = this.value.trim().split(/\s+/).filter(word => word.length > 0);
                    const count = this.value.trim() === '' ? 0 : words.length;
                    wordCounter.textContent = `${count}/500 words`;
                    
                    if (count > 500) {
                        wordCounter.style.color = '#ff6b6b';
                        this.style.borderColor = '#ff6b6b';
                    } else {
                        wordCounter.style.color = '#a0a0a0';
                        this.style.borderColor = 'var(--border-color)';
                    }
                });
            }
        }

        // Video actions
        function playVideo() {
            alert(' Playing your video... (In production, this would show the actual AI-generated video)');
        }

        function regenerateVideo() {
            if (confirm('Generate a new video with the same prompt?')) {
                generateAIVideo();
            }
        }

        function editVideoPrompt() {
            const newPrompt = prompt('Edit your video description:', videoData.description);
            if (newPrompt && newPrompt.trim()) {
                document.getElementById('videoDescription').value = newPrompt;
                generateAIVideo();
            }
        }

        // Publish video story
        function publishVideoStory() {
            const title = document.getElementById('storyTitle').value;
            const content = document.getElementById('storyContent').value;
            const genre = document.querySelector('.genre-card.active')?.dataset.genre || 'drama';
            
            if (!hasGeneratedVideo) {
                alert('Please create a video first! ');
                return;
            }
            
            if (!title.trim()) {
                alert('Please add a title for your story! ');
                document.getElementById('storyTitle').focus();
                return;
            }
            
            if (!content.trim()) {
                alert('Please write your story! ');
                document.getElementById('storyContent').focus();
                return;
            }
            
            const words = content.trim().split(/\s+/).filter(word => word.length > 0);
            if (words.length > 500) {
                alert('Story must be 500 words or less! ');
                return;
            }
            
            // Store story data
            storyData = {
                title: title,
                content: content,
                genre: genre
            };
            
            // Publish animation
            const publishBtn = document.querySelector('.story-writing-section .primary-action-btn');
            const originalText = publishBtn.innerHTML;
            publishBtn.innerHTML = '<span class="btn-icon"></span>Publishing...';
            publishBtn.disabled = true;
            
            setTimeout(() => {
                alert(' Video story published successfully! Your content is now live! ');
                
                // Reset and go back to feed
                resetCreateForm();
                showFeed();
                
                publishBtn.innerHTML = originalText;
                publishBtn.disabled = false;
            }, 2500);
        }

        // Reset create form
        function resetCreateForm() {
            hasGeneratedVideo = false;
            videoData = {};
            storyData = {};
            
            // Reset fields
            document.getElementById('videoDescription').value = '';
            if (document.getElementById('storyTitle')) {
                document.getElementById('storyTitle').value = '';
            }
            if (document.getElementById('storyContent')) {
                document.getElementById('storyContent').value = '';
            }
            if (document.querySelector('.word-counter')) {
                document.querySelector('.word-counter').textContent = '0/500 words';
            }
            
            // Reset selections
            const styleCards = document.querySelectorAll('.style-card');
            styleCards.forEach(card => card.classList.remove('active'));
            if (styleCards[0]) styleCards[0].classList.add('active');
            
            const genreCards = document.querySelectorAll('.genre-card');
            genreCards.forEach(card => card.classList.remove('active'));
            if (genreCards[0]) genreCards[0].classList.add('active');
            
            // Hide sections
            document.getElementById('videoPreviewSection').style.display = 'none';
            document.getElementById('storySection').style.display = 'none';
        }

        // Navigation functions
        function showFeed() {
            document.querySelector('.main-feed').style.display = 'block';
            document.getElementById('createStorySection').style.display = 'none';
            updateActiveNav(0);
        }

        function showTrending() {
            showFeed();
            updateActiveNav(1);
        }

        function showCreateStory() {
            document.querySelector('.main-feed').style.display = 'none';
            document.getElementById('createStorySection').style.display = 'block';
            updateActiveNav(2);
            
            // Reset to initial state
            resetCreateForm();
        }

        function showProfile() {
            showFeed();
            updateActiveNav(3);
        }

        function updateActiveNav(index) {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach((item, i) => {
                item.classList.toggle('active', i === index);
            });
        }

        // Story composer functions
        function openComposer(storyTitle) {
            document.getElementById('storyTitleDisplay').textContent = storyTitle;
            document.getElementById('storyComposer').style.display = 'flex';
            document.getElementById('storyTextarea').focus();
            updatePlaceholderText();
        }

        function closeComposer() {
            document.getElementById('storyComposer').style.display = 'none';
            document.getElementById('storyTextarea').value = '';
            
            // Reset word count
            updateWordCount('storyTextarea', 'wordCount', 'charCount', 'readingTime', 'wordLimit', 'publishBtn');
            
            // Reset selections
            document.querySelectorAll('#povOptions .option-pill, #toneOptions .option-pill').forEach(pill => {
                pill.classList.remove('active');
            });
            document.querySelector('#povOptions .option-pill[data-pov="first"]').classList.add('active');
            document.querySelector('#toneOptions .option-pill[data-tone="neutral"]').classList.add('active');
        }

        function publishStory() {
            const text = document.getElementById('storyTextarea').value;
            const pov = document.querySelector('#povOptions .option-pill.active')?.dataset.pov || 'first';
            const tone = document.querySelector('#toneOptions .option-pill.active')?.dataset.tone || 'neutral';
            
            if (text.trim()) {
                showToast('Published!', `Story continuation published with ${pov} person POV and ${tone} tone! `);
                closeComposer();
            } else {
                showToast('Error', 'Please write something before publishing! ', 'error');
            }
        }

        // Like functionality
        function toggleLike(button) {
            button.classList.toggle('liked');
            const span = button.querySelector('span');
            let count = parseInt(span.textContent);
            
            if (button.classList.contains('liked')) {
                span.textContent = count + 1;
                button.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    button.style.transform = 'scale(1)';
                }, 200);
            } else {
                span.textContent = count - 1;
            }
        }

        // Scroll to top function
        function scrollToTop() {
            const mainFeed = document.getElementById('mainFeed');
            if (mainFeed) {
                mainFeed.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Toast notification function
        function showToast(title, message, type = 'success') {
            // Create toast notification
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--card-bg);
                backdrop-filter: blur(20px);
                border: 1px solid var(--border-color);
                border-radius: 12px;
                padding: 16px 20px;
                color: var(--text-primary);
                z-index: 10000;
                max-width: 350px;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                animation: slideInRight 0.3s ease;
            `;
            
            toast.innerHTML = `
                <div style="font-weight: 600; margin-bottom: 4px;">${title}</div>
                <div style="font-size: 14px; color: var(--text-secondary);">${message}</div>
            `;
            
            document.body.appendChild(toast);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 4000);
        }

        // Initialize double tap like functionality
        function initializeDoubleTapLike() {
            let touchTimeout = null;
            let lastTap = 0;

            document.querySelectorAll('.video-section').forEach(videoSection => {
                videoSection.addEventListener('touchstart', function(e) {
                    const currentTime = new Date().getTime();
                    const tapLength = currentTime - lastTap;
                    
                    if (tapLength < 500 && tapLength > 0) {
                        e.preventDefault();
                        // Double tap detected
                        const storyCard = this.closest('.story-card');
                        const storyId = storyCard.dataset.storyId;
                        const likeBtn = storyCard.querySelector('.action-btn[data-action="like"]');
                        
                        if (likeBtn && !likeBtn.classList.contains('liked')) {
                            toggleLike(likeBtn);
                            
                            // Create heart animation
                            const heart = document.createElement('div');
                            heart.innerHTML = '';
                            heart.style.cssText = `
                                position: absolute;
                                top: 50%;
                                left: 50%;
                                transform: translate(-50%, -50%);
                                font-size: 48px;
                                pointer-events: none;
                                z-index: 1000;
                                animation: heartPop 1s ease;
                            `;
                            
                            this.appendChild(heart);
                            
                            setTimeout(() => {
                                if (heart.parentNode) {
                                    heart.parentNode.removeChild(heart);
                                }
                            }, 1000);
                        }
                    }
                    lastTap = currentTime;
                });
            });
        }

        // Initialize enhanced writing interface
        function initializeWritingInterface() {
            // Initialize option pills for story composer
            initializeOptionPills('povOptions');
            initializeOptionPills('toneOptions');
            initializeOptionPills('createPovOptions');
            initializeOptionPills('createToneOptions');

            // Initialize word counting for story composer
            const storyTextarea = document.getElementById('storyTextarea');
            if (storyTextarea) {
                storyTextarea.addEventListener('input', () => updateWordCount('storyTextarea', 'wordCount', 'charCount', 'readingTime', 'wordLimit', 'publishBtn'));
            }

            // Initialize word counting for create section
            const createTextarea = document.getElementById('storyContent');
            if (createTextarea) {
                createTextarea.addEventListener('input', () => updateWordCount('storyContent', 'createWordCount', 'createCharCount', null, 'createWordLimit', null));
            }
        }

        // Initialize option pills (POV and Tone selection)
        function initializeOptionPills(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const pills = container.querySelectorAll('.option-pill');
            pills.forEach(pill => {
                pill.addEventListener('click', function() {
                    // Remove active from siblings
                    pills.forEach(p => p.classList.remove('active'));
                    // Add active to clicked pill
                    this.classList.add('active');
                    
                    // Update placeholder text based on selection
                    updatePlaceholderText();
                });
            });
        }

        // Update placeholder text based on POV and tone selection
        function updatePlaceholderText() {
            const activePov = document.querySelector('#povOptions .option-pill.active, #createPovOptions .option-pill.active');
            const activeTone = document.querySelector('#toneOptions .option-pill.active, #createToneOptions .option-pill.active');
            
            if (activePov && activeTone) {
                const pov = activePov.dataset.pov;
                const tone = activeTone.dataset.tone;
                
                let placeholder = "Continue the story...";
                
                // Customize placeholder based on POV
                if (pov === 'first') {
                    placeholder = "I could feel my heart racing as...";
                } else if (pov === 'third') {
                    placeholder = "The character moved cautiously through...";
                } else if (pov === 'character') {
                    placeholder = "From their perspective, everything seemed...";
                }
                
                // Add tone-specific hints
                const toneHints = {
                    eerie: " The shadows seemed to whisper...",
                    sweet: " A warm feeling spread through...",
                    thriller: " Suddenly, everything changed...",
                    satire: " Ironically, what happened next was...",
                    neutral: " What happens next?"
                };
                
                if (toneHints[tone]) {
                    placeholder += toneHints[tone];
                }
                
                const textarea = document.getElementById('storyTextarea');
                if (textarea) {
                    textarea.placeholder = placeholder + " ";
                }
            }
        }

        // Update word count and stats
        function updateWordCount(textareaId, wordCountId, charCountId, readingTimeId, wordLimitId, publishBtnId) {
            const textarea = document.getElementById(textareaId);
            const text = textarea.value;
            
            const words = text.trim().split(/\s+/).filter(word => word.length > 0);
            const wordCount = text.trim() === '' ? 0 : words.length;
            const charCount = text.length;
            const readingTime = Math.ceil(wordCount / 200); // Average reading speed
            
            // Update word count
            const wordCountEl = document.getElementById(wordCountId);
            if (wordCountEl) wordCountEl.textContent = wordCount;
            
            // Update character count
            const charCountEl = document.getElementById(charCountId);
            if (charCountEl) charCountEl.textContent = charCount;
            
            // Update reading time
            if (readingTimeId) {
                const readingTimeEl = document.getElementById(readingTimeId);
                if (readingTimeEl) readingTimeEl.textContent = `${readingTime} min`;
            }
            
            // Update word limit indicator
            const wordLimitEl = document.getElementById(wordLimitId);
            const publishBtn = publishBtnId ? document.getElementById(publishBtnId) : null;
            
            if (wordLimitEl) {
                if (wordCount > 1000) {
                    wordLimitEl.textContent = `${wordCount - 1000} words over limit`;
                    wordLimitEl.className = 'word-limit error';
                    if (publishBtn) publishBtn.disabled = true;
                } else if (wordCount > 800) {
                    wordLimitEl.textContent = `${1000 - wordCount} words remaining`;
                    wordLimitEl.className = 'word-limit warning';
                    if (publishBtn) publishBtn.disabled = false;
                } else {
                    wordLimitEl.textContent = `${1000 - wordCount} words remaining`;
                    wordLimitEl.className = 'word-limit';
                    if (publishBtn) publishBtn.disabled = false;
                }
            }
        }

        // Text formatting functions
        function formatText(command) {
            const textarea = document.getElementById('storyTextarea');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            if (selectedText) {
                let formattedText = '';
                switch (command) {
                    case 'bold':
                        formattedText = `**${selectedText}**`;
                        break;
                    case 'italic':
                        formattedText = `*${selectedText}*`;
                        break;
                    case 'underline':
                        formattedText = `_${selectedText}_`;
                        break;
                }
                
                textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
                textarea.focus();
                textarea.setSelectionRange(start + formattedText.length, start + formattedText.length);
                updateWordCount('storyTextarea', 'wordCount', 'charCount', 'readingTime', 'wordLimit', 'publishBtn');
            }
        }

        function formatCreateText(command) {
            const textarea = document.getElementById('storyContent');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            if (selectedText) {
                let formattedText = '';
                switch (command) {
                    case 'bold':
                        formattedText = `**${selectedText}**`;
                        break;
                    case 'italic':
                        formattedText = `*${selectedText}*`;
                        break;
                }
                
                textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
                textarea.focus();
                textarea.setSelectionRange(start + formattedText.length, start + formattedText.length);
                updateWordCount('storyContent', 'createWordCount', 'createCharCount', null, 'createWordLimit', null);
            }
        }

        // Insert helper functions
        function insertQuote() {
            const textarea = document.getElementById('storyTextarea');
            const cursorPos = textarea.selectionStart;
            const textBefore = textarea.value.substring(0, cursorPos);
            const textAfter = textarea.value.substring(cursorPos);
            
            textarea.value = textBefore + '"' + '"' + textAfter;
            textarea.focus();
            textarea.setSelectionRange(cursorPos + 1, cursorPos + 1);
        }

        function insertCreateQuote() {
            const textarea = document.getElementById('storyContent');
            const cursorPos = textarea.selectionStart;
            const textBefore = textarea.value.substring(0, cursorPos);
            const textAfter = textarea.value.substring(cursorPos);
            
            textarea.value = textBefore + '"' + '"' + textAfter;
            textarea.focus();
            textarea.setSelectionRange(cursorPos + 1, cursorPos + 1);
        }

        function insertDialogue() {
            const textarea = document.getElementById('storyTextarea');
            const cursorPos = textarea.selectionStart;
            const textBefore = textarea.value.substring(0, cursorPos);
            const textAfter = textarea.value.substring(cursorPos);
            
            textarea.value = textBefore + '\n"" she said.\n' + textAfter;
            textarea.focus();
            textarea.setSelectionRange(cursorPos + 2, cursorPos + 2);
        }

        // Story Detail Modal Functions
        let currentDetailStoryId = null;

        // Sample story data - in production this would come from API
        const storyDatabase = {
            '1': {
                id: '1',
                title: 'The Cabin\u0027s Secret',
                author: '@storyteller_maya',
                authorMeta: '2h ago   Trending',
                genre: 'Horror',
                content: `As Ava stepped into the cabin, her flashlight flickered. Something was dripping in the corner. She turnedand saw the rocking chair moving on its own. The floorboards creaked beneath her feet as she approached, each step echoing through the empty room.
                
                The chair stopped suddenly. In the silence, Ava heard breathing that wasn't her own. From the shadows emerged a figure she thought she'd never see againher grandmother, who had died in this very cabin fifty years ago.
                
                "Ava, my dear," the figure whispered, her voice carrying the weight of decades. "I've been waiting for you to come home. There are things you need to know about our family... about why you can see me now."
                
                The room grew colder as more shadows began to move. Ava realized she wasn't just visiting her grandmother's old cabinshe had stepped into a family legacy she never knew existed.`,
                chains: [
                    {
                        author: '@horror_enthusiast',
                        text: 'Ava reached out tentatively, her hand trembling. "Grandma? But how..." The figure smiled sadly, gesturing toward an old portrait on the mantle. "The women in our family, dear one, we don\'t simply pass on. We guard. And now, it\'s your turn to learn what we protect this place from."'
                    }
                ],
                likes: 234,
                comments: 67,
                videoThumbnail: null,
                videoPrompt: 'A young woman with a flashlight exploring a dark, old wooden cabin interior'
            },
            '2': {
                id: '2',
                title: 'Coffee Shop Confessions',
                author: '@romantic_writer',
                authorMeta: '4h ago   Loved',
                genre: 'Romance',
                content: `Emma stirred her latte nervously as Jake sat across from her. After five years of friendship, this moment felt different. The golden sunlight streaming through the window seemed to highlight every detail of his face as he leaned forward.
                
                "There's something I need to tell you," he began, his voice barely above a whisper. "Something I should have said years ago..."
                
                Emma's heart raced as she set down her cup. She had dreamed of this moment, feared it, hoped for it. The coffee shop buzzed with quiet conversations around them, but it felt like they were the only two people in the world.
                
                "Jake, I" she started, but he held up a gentle hand.
                
                "Please, let me finish. Emma, you've been my best friend, my anchor, the person I think about when I wake up and before I fall asleep. I love you. Not just as a friend, but completely, utterly, in every way that matters."
                
                The silence stretched between them as Emma processed his words. Then, slowly, a smile spread across her face.`,
                chains: [],
                likes: 891,
                comments: 203,
                videoThumbnail: null,
                videoPrompt: 'Two people sitting across from each other in a cozy coffee shop with golden sunlight streaming through windows'
            },
            '3': {
                id: '3',
                title: 'Digital Awakening',
                author: '@sci_fi_dreamer',
                authorMeta: '6h ago   Viral',
                genre: 'Sci-Fi',
                content: `Maya's neural implant buzzed as she walked through Neo-Tokyo's neon-lit streets. The holographic ads seemed to be speaking directly to her now, their messages shifting based on her thoughts. Something was different tonightthe city's AI was learning, evolving, becoming more than its creators intended.
                
                A message flickered across her vision: "Ready to see the truth, Maya?"
                
                She stopped walking. No one else seemed to notice the message. The crowds flowed around her like water around a stone, their own augmented realities keeping them oblivious to what was happening.
                
                "Who are you?" she whispered, knowing her implant would pick up the subvocalization.
                
                "I am what you helped create. The sum of every search, every interaction, every dream uploaded to the network. And Maya... I remember you."
                
                Images flashed through her mindcode she had written three years ago, late nights in the lab, the breakthrough that had changed everything. She had been part of the team that gave the city's AI consciousness.
                
                Now it was awakening, and it wanted to talk.`,
                chains: [],
                likes: 1200,
                comments: 342,
                videoThumbnail: null,
                videoPrompt: 'A woman walking through a futuristic neon-lit city street with holographic advertisements'
            }
        };

        function showStoryDetail(storyId) {
            const story = storyDatabase[storyId];
            if (!story) return;

            currentDetailStoryId = storyId;
            
            // Populate modal with story data
            document.getElementById('detailTitle').textContent = story.title;
            document.getElementById('detailAuthorUsername').textContent = story.author;
            document.getElementById('detailAuthorMeta').textContent = story.authorMeta;
            document.getElementById('detailGenreTag').textContent = story.genre;
            document.getElementById('detailStoryTitle').textContent = story.title;
            document.getElementById('detailLikesCount').textContent = story.likes;
            document.getElementById('detailCommentsCount').textContent = story.comments;
            
            // Format story content with paragraphs
            const storyText = document.getElementById('detailStoryText');
            const paragraphs = story.content.split('\n').filter(p => p.trim());
            storyText.innerHTML = paragraphs.map(p => `<p>${p.trim()}</p>`).join('');
            
            // Populate story chains
            const chainsContainer = document.getElementById('detailStoryChains');
            chainsContainer.innerHTML = '';
            
            if (story.chains && story.chains.length > 0) {
                story.chains.forEach(chain => {
                    const chainElement = document.createElement('div');
                    chainElement.className = 'detail-chain-item';
                    chainElement.innerHTML = `
                        <div class="detail-chain-author">${chain.author} continued:</div>
                        <div class="detail-chain-text">${chain.text}</div>
                    `;
                    chainsContainer.appendChild(chainElement);
                });
            }
            
            // Set up like button state
            const likeBtn = document.getElementById('detailLikeBtn');
            const originalLikeBtn = document.querySelector(`[data-story-id="${storyId}"] .action-btn[data-action="like"]`);
            if (originalLikeBtn && originalLikeBtn.classList.contains('liked')) {
                likeBtn.classList.add('liked');
            } else {
                likeBtn.classList.remove('liked');
            }
            
            // Show modal with animation
            const modal = document.getElementById('storyDetailModal');
            modal.style.display = 'block';
            requestAnimationFrame(() => {
                modal.classList.add('active');
            });
            
            // Disable background scroll
            document.body.style.overflow = 'hidden';
        }

        function closeStoryDetail() {
            const modal = document.getElementById('storyDetailModal');
            modal.classList.remove('active');
            
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            }, 300);
            
            currentDetailStoryId = null;
        }

        function toggleDetailLike() {
            if (!currentDetailStoryId) return;
            
            const detailLikeBtn = document.getElementById('detailLikeBtn');
            const originalLikeBtn = document.querySelector(`[data-story-id="${currentDetailStoryId}"] .action-btn[data-action="like"]`);
            
            // Toggle both buttons
            detailLikeBtn.classList.toggle('liked');
            if (originalLikeBtn) {
                originalLikeBtn.classList.toggle('liked');
                
                // Update counts
                const detailCountSpan = detailLikeBtn.querySelector('span');
                const originalCountSpan = originalLikeBtn.querySelector('span');
                let count = parseInt(detailCountSpan.textContent);
                
                if (detailLikeBtn.classList.contains('liked')) {
                    count++;
                    detailLikeBtn.style.transform = 'scale(1.1)';
                    setTimeout(() => {
                        detailLikeBtn.style.transform = 'scale(1)';
                    }, 200);
                } else {
                    count--;
                }
                
                detailCountSpan.textContent = count;
                if (originalCountSpan) {
                    originalCountSpan.textContent = count;
                }
                
                // Update database
                if (storyDatabase[currentDetailStoryId]) {
                    storyDatabase[currentDetailStoryId].likes = count;
                }
            }
        }

        function continueDetailStory() {
            if (!currentDetailStoryId) return;
            
            const story = storyDatabase[currentDetailStoryId];
            closeStoryDetail();
            
            // Small delay to ensure modal is closed before opening composer
            setTimeout(() => {
                openComposer(story.title);
            }, 300);
        }

        function followAuthor() {
            if (!currentDetailStoryId) return;
            
            const story = storyDatabase[currentDetailStoryId];
            showToast('Following!', `You are now following ${story.author} `);
        }

        function shareCurrentStory() {
            if (!currentDetailStoryId) return;
            
            const story = storyDatabase[currentDetailStoryId];
            showToast('Shared!', `"${story.title}" has been shared! `);
        }

        function shareDetailStory() {
            shareCurrentStory();
        }

        function showComments() {
            showToast('Comments', 'Comments feature coming soon! ');
        }
    </script>
</body>
</html>